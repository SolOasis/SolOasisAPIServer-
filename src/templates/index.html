<!DOCTYPE html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>
function UpdateStatus() {
    $.getJSON('/drone/api/v1.0/drones', function(data, status) {
        tmp_text = "<p> Connected drones (ID:Name / assigned): </p> ";
        $.each( data.drones, function( droneID, droneInfo ) {
            if (droneID != 'function') {
                tmp_text += droneID + ": " + droneInfo.Name + " / AssignedState " + droneInfo.AssignedState + " <br>";
            }
        });
        $("#getAllDronesResult").html(tmp_text);
    });
}
$(document).ready(function() {
    UpdateStatus();
    $("#search").click(function(){
        $.getJSON('/drone/api/v1.0/search', function(data, status) {
            $("#searchResult").text(data.function+", Devices num: "+data.devicesNum);
        }).error(function(jqXHR, textStatus, errorThrown){
            alert("error occurred!");
        });
        UpdateStatus();
    });
    $("#release").click(function(){
        $.getJSON('/drone/api/v1.0/release', function(data, status) {
        }).error(function(jqXHR, textStatus, errorThrown){
            alert("error occurred!");
        });
        UpdateStatus();
    });
    $("#assign").click(function(){
        $.getJSON('/drone/api/v1.0/assign', function(data, status) {
            if (data.droneID === false){
                alert("error: No more drones!");
                return false;
            }
            $("#assignResult").text(data.function+", Assigned ID: "+data.droneID);
        }).error(function(jqXHR, textStatus, errorThrown){
            alert("error occurred!");
        });
        UpdateStatus();
    });
    $("#state").click(function(){
        ID = $("#droneID").val();
        $.getJSON('/drone/api/v1.0/drones/' + ID,  function(data, status) {
            if (data.state === false) {
                alert("error: Drone not found!");
                return false;
            }
            var state = [];
            state.push(data.function)
                state.push("<br>DroneID:" + data.drone)
            $.each( data.state.ardrone3, function( key, val ) {
                state2 = [];
                $.each( val, function( k, v ) {
                    state3 = [];
                    $.each( v, function( kk, vv ) {
                        state3.push(kk+":"+vv+" ");
                    });
                    state2.push("<p>"+k+":"+state3+"</p>");
                });
                state.push("<h3>"+key+":</h3>"+state2+"<br>");
            });
            $.each( data.state.common, function( key, val ) {
                state2 = [];
                $.each( val, function( k, v ) {
                    state3 = [];
                    $.each( v, function( kk, vv ) {
                        state3.push(kk+":"+vv+" ");
                    });
                    state2.push("<p>"+k+":"+state3+"</p>");
                });
                state.push("<h3>"+key+":</h3>"+state2+"<br>");
            });
            $("#stateResult").html(state);
        }).error(function(jqXHR, textStatus, errorThrown){
            alert("error occurred!");
        });
        UpdateStatus();
    });
});
</script>
<title> Drone API server Index </title>
<h1>Drone API server</h1>
<p> Please "Search" first, then "Assign" a drone to the client. </p>
<p> "Release" would disconnect all drones. </p>
<p> "State" shows all iner state of the specified drone. </p>

<h3> Status </h3>
<p id="getAllDronesResult"></p>
<button id="search">Search</button>
<p id="searchResult"></p>
<button id="release">Release</button>
<p></p>
<button id="assign">Assign</button>
<p id="assignResult"></p>
<button id="state">State</button>
droneID: <input type="text" size="5" id="droneID" value=2>
<p id="stateResult"></p>

<h3> API lists: </h3>
<p>
GET <br>
/drone/api/v1.0/search <br>
/drone/api/v1.0/assign <br>
/drone/api/v1.0/release <br>
/drone/api/v1.0/drones <br>
/drone/api/v1.0/drones/droneID <br>
/drone/api/v1.0/battery/droneID <br>
/drone/api/v1.0/regain/droneID <br>
/drone/api/v1.0/getpicture/droneID <br>
</p>
<p>
PATCH<br>
/drone/api/v1.0/navigate/droneID <br>
</p>
